<!doctype html>
<html class="docs-version-2.0.0-beta.15" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Gitcoins RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Gitcoins Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/blog/feed.json" title="Gitcoins JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141789564-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-141789564-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Gitcoins" href="/zh-CN/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/changelog/rss.xml" title="Docusaurus changelog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/changelog/atom.xml" title="Docusaurus changelog Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/changelog/feed.json" title="Docusaurus changelog JSON Feed">
<link rel="icon" href="/zh-CN/img/docusaurus.png">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/zh-CN/img/docusaurus.png">
<link rel="mask-icon" href="/zh-CN/img/docusaurus.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/zh-CN/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/tests/blog/rss.xml" title="Docusaurus Tests Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/tests/blog/atom.xml" title="Docusaurus Tests Blog Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/tests/blog/feed.json" title="Docusaurus Tests Blog JSON Feed">
<link rel="stylesheet" href="/katex/katex.min.css"><title data-rh="true">Symmetric Cryptography | Gitcoins</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://thebestornothing.github.io/zh-CN/img/docusaurus-soc.png"><meta data-rh="true" name="twitter:image" content="https://thebestornothing.github.io/zh-CN/img/docusaurus-soc.png"><meta data-rh="true" property="og:url" content="https://thebestornothing.github.io/zh-CN/docs/tls/symmetric-cryptography"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docsearch:version" content="2.0.0-beta.15"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.0.0-beta.15"><meta data-rh="true" property="og:title" content="Symmetric Cryptography | Gitcoins"><meta data-rh="true" name="description" content="Overview of symmetric cryptography"><meta data-rh="true" property="og:description" content="Overview of symmetric cryptography"><link data-rh="true" rel="icon" href="/zh-CN/img/docusaurus.ico"><link data-rh="true" rel="canonical" href="https://thebestornothing.github.io/zh-CN/docs/tls/symmetric-cryptography"><link data-rh="true" rel="alternate" href="https://thebestornothing.github.io/docs/tls/symmetric-cryptography" hreflang="en"><link data-rh="true" rel="alternate" href="https://thebestornothing.github.io/zh-CN/docs/tls/symmetric-cryptography" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://thebestornothing.github.io/docs/tls/symmetric-cryptography" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X1Z85QJPUV-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.d1be34a2.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.0163afa3.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.bb624438.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_mT26">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark navbarHideable_ywau"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/docusaurus.svg" alt="Docusaurus Logo" class="themedImage_xWK_ themedImage--light_gwRJ" height="32" width="32"><img src="/zh-CN/img/docusaurus_keytar.svg" alt="Docusaurus Logo" class="themedImage_xWK_ themedImage--dark_qMqj" height="32" width="32"></div><b class="navbar__title">Gitcoins</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/tls/ssl-tls-overview">TLS</a><a class="navbar__item navbar__link" href="/zh-CN/docs">Docus</a><a class="navbar__item navbar__link" href="/zh-CN/docs/cli">API</a><a class="navbar__item navbar__link" href="/zh-CN/blog">Blog</a><a class="navbar__item navbar__link" href="/zh-CN/showcase">Showcase</a><a class="navbar__item navbar__link" href="/zh-CN/community/support">Community</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/zh-CN/docs">2.0.0-beta.15</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/docs/next/tls/symmetric-cryptography">2.0.0-beta.16 🚧</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-CN/docs/tls/symmetric-cryptography">2.0.0-beta.15</a></li><li><a class="dropdown__link" href="/zh-CN/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_bd53"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文（中国）</span></span></a><ul class="dropdown__menu"><li><a href="/docs/tls/symmetric-cryptography" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/docs/tls/symmetric-cryptography" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">中文（中国）</a></li><li><a href="https://github.com/facebook/docusaurus/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/TheBestOrNothing/thebestornothing.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link-white" aria-label="GitHub repository"></a><div class="toggle_YJEG toggle_Vn4N toggleDisabled__7Y2"><div class="toggleTrack_N2ek" role="button" tabindex="-1"><div class="toggleTrackCheck_r6Nr"><span class="toggleIcon_P87V">🌜</span></div><div class="toggleTrackX_Vi_p"><span class="toggleIcon_P87V">🌞</span></div><div class="toggleTrackThumb_lsPM"></div></div><input type="checkbox" class="toggleScreenReader_jeIL" aria-label="Switch between dark and light mode"></div><div class="searchBox_dmiZ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_f3Tp"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_niX8" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_b9v0"><div class="sidebar_DFkW sidebarWithHideableNavbar_LzGe"><a tabindex="-1" class="sidebarLogo_YYZ2" href="/zh-CN/"><img src="/zh-CN/img/docusaurus.svg" alt="Docusaurus Logo" class="themedImage_xWK_ themedImage--light_gwRJ" height="32" width="32"><img src="/zh-CN/img/docusaurus_keytar.svg" alt="Docusaurus Logo" class="themedImage_xWK_ themedImage--dark_qMqj" height="32" width="32"><b>Gitcoins</b></a><nav class="menu thin-scrollbar menu_Np7P"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/tls/ssl-tls-overview">TLS Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh-CN/docs/tls/symmetric-cryptography">Symmetric Cryptography</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/tls/asymmetric-cryptography">Asymmetric Cryptography</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_NWHj"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_azzv"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_KNC3"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Nlyw"><div class="docItemContainer_ohcw"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.0.0-beta.15</span><div class="tocCollapsible_fIYe theme-doc-toc-mobile tocMobile_bm_u"><button type="button" class="clean-btn tocCollapsibleButton_TQR1">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Symmetric Cryptography</h1></header><blockquote><p>Copyright: the following content is totally copy from the <a href="https://dev.to/techschoolguru/a-complete-overview-of-ssl-tls-and-its-cryptographic-system-36pd" target="_blank" rel="noopener noreferrer">TECHSCHOOL</a>.</p></blockquote><p><img loading="lazy" alt="symmetric-cryptography" src="/zh-CN/assets/images/symmetric-cryptography-b5e11f8d1e27a9ccf231b58336503873.png" width="880" height="495">
Alright, now let’s learn more about symmetric cryptography. I guess you’ve already known the basics.
First of all, Alice has a plaintext message that she wants to send to Bob, but doesn’t want any one in the public zone to read it.
So she encrypts the message with a secret key that they have shared with each other before. Then she sends the encrypted message to Bob via the public internet.
Upon receiving the encrypted message, Bob will easily use the same secret key to decrypt it.
Since the same key is used for encryption and decryption, it’s kind of symmetric, so we have the name symmetric cryptography.
Now there might be a hacker Harry, who can catch their exchanged message on the public network. However, the message is already encrypted, and Harry doesn’t have the secret key, so he won’t be able to decrypt it.
But he can still change it!</p><h2 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="bit-flipping-attack">Bit-flipping attack<a class="hash-link" href="#bit-flipping-attack" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="bit-flipping" src="/zh-CN/assets/images/bit-flipping-11b09fe14207211a5cd3a1c802ad7b2f.png" width="880" height="495">
There’s one technique called bit-flipping attack that works like this:
Let’s say this time Alice is not talking to Bob, but talking to her online bank. And she wants to send 100 dollars to someone. The message is encrypted with a secret key and sent to the bank via the internet.
Now Harry catches the encrypted message. Although he can’t decrypt it, he can flip some of its bits from 1 to 0 and from 0 to 1, then forward that modified message to the bank.
Now when the bank decrypts it, they will get a different plaintext content. In this case, it has become 900 dollars instead of 100.
So it’s very dangerous. That’s why we need to make sure that the encrypted message hasn’t been altered during transmission.</p><p><strong>But how?</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="authenticated-encryption-ae">Authenticated Encryption (AE)<a class="hash-link" href="#authenticated-encryption-ae" title="Direct link to heading">​</a></h2><p>One way to do that is to use Authenticated Encryption. The idea is to not just encrypt, but also authenticate the encrypted message.
<img loading="lazy" alt="ae" src="/zh-CN/assets/images/ae-478c885568dbf7cfa7ad56ecc4e7248d.png" width="880" height="495"></p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="the-first-step-is-to-encrypt">The first step is to encrypt.<a class="hash-link" href="#the-first-step-is-to-encrypt" title="Direct link to heading">​</a></h3><p>Alice’s plaintext message goes through a symmetric encryption algorithm, such as AES-256-GCM or CHACHA20.
This encryption algorithm also takes a shared secret key and a random nonce, or an initialization vector (IV) as input. And it will return the encrypted message.</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="the-second-step-is-to-authenticate">The second step is to authenticate.<a class="hash-link" href="#the-second-step-is-to-authenticate" title="Direct link to heading">​</a></h3><p>The encrypted message, the secret key, and the nonce become inputs of a MAC algorithm, such as GMAC if you use AES-256-GCM, or POLY1305 if you use CHACHA20 encryption algorithm.
This MAC algorithm acts like a cryptographic hash function, and its output is a MAC, or message authentication code.
Now this MAC will be tagged along with the encrypted message, and the final result will be sent to Bob. Because of this, we sometimes call this MAC an authentication tag.</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="add-some-associated-data-ad">Add some Associated Data (AD)<a class="hash-link" href="#add-some-associated-data-ad" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="ad" src="/zh-CN/assets/images/ad-f0f93105964f0710e924b848c04e98a0.png" width="880" height="495">
In TLS 1.3, besides the encrypted message, we also want to authenticate some associated data, such as: the addresses, the ports, the protocol version, or the sequence number. This information is unencrypted and known by both communicating parties.
So the associated data is also an input of the MAC algorithm. And because of this, the whole process is called Authenticated Encryption with Associated Data, or in short, <strong> AEAD </strong>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="decryption-and-mac-verification">Decryption and MAC verification<a class="hash-link" href="#decryption-and-mac-verification" title="Direct link to heading">​</a></h3><p>Now let&#x27;s see how Bob can check that the encrypted message hasn’t been changed during transmission.
<img loading="lazy" alt="decrypt" src="/zh-CN/assets/images/decrypt-f9df3565ff24b95595ba7b3e67208554.png" width="880" height="495">
It’s simply a reverse process. Starting with the encrypted message with MAC, we untag the MAC from the encrypted message.
Then the encrypted message will go to the MAC algorithm together with the shared secret key and the nonce. Note that this is the same nonce that is used in the encryption process. Usually the nonce is padded to the encrypted message before sending to the receiver.
The associated data will also go into the MAC algorithm. And the output of it will be another MAC.</p><p><img loading="lazy" alt="verify" src="/zh-CN/assets/images/verify-401dd73adf8864b261e8e87f26e00558.png" width="880" height="495">
Now Bob can simply compare the 2 MAC values. If they’re different then he knows that the encrypted message has been changed. Else, he can safely decrypt the message and use it with the confident that it’s the same plaintext message that Alice sent.</p><h2 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="secret-key-exchange">Secret key exchange<a class="hash-link" href="#secret-key-exchange" title="Direct link to heading">​</a></h2><p>However, there’s 1 question: How Bob and Alice share the secret key with each other without leaking it to the public?
<img loading="lazy" alt="key-exchange" src="/zh-CN/assets/images/key-exchange-7c6d839dc53eb462ced9ed1e5c3850dd.png" width="880" height="495">
Well, the answer is: they need to use asymmetric or public-key cryptography for that purpose. Specifically, they can use either Diffie-Hellman Ephemeral, or Elliptic-Curve Diffie-Hellman Ephemeral.</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="diffie-hellman-key-exchange">Diffie-Hellman key exchange<a class="hash-link" href="#diffie-hellman-key-exchange" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="DH" src="/zh-CN/assets/images/DH-211e4244fe048e4848c4981e480f4613.png" width="880" height="495">
Let’s see how Diffie Hellman key-exchange works!
First, Alice and Bobs both agree on 2 numbers: the base g, and the modulus p. These numbers are known publicly by everyone.
Then each of them secretly choose a private number. Alice’s private key is number a, and Bob’s private key is number b.
Then Alice computes her public key and sends it to Bob:</p><div class="codeBlockContainer_RIuc theme-code-block"><div class="codeBlockContent_DOR6"><pre tabindex="0" class="prism-code language-text codeBlock_SvlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kiFP"><span class="token-line" style="color:#393A34"><span class="token plain">A = (g^a) mod p</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_veCs clean-btn">Copy</button></div></div><p>Similarly, Bob computes his public key and sends it to Alice:</p><div class="codeBlockContainer_RIuc theme-code-block"><div class="codeBlockContent_DOR6"><pre tabindex="0" class="prism-code language-text codeBlock_SvlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kiFP"><span class="token-line" style="color:#393A34"><span class="token plain"> B = (g^b) mod p</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_veCs clean-btn">Copy</button></div></div><p>Then Alice will receive Bob’s public key B, and Bob will receive Alice’s public key A.</p><p>Now the magic happens!</p><p>Alice computes:</p><div class="codeBlockContainer_RIuc theme-code-block"><div class="codeBlockContent_DOR6"><pre tabindex="0" class="prism-code language-text codeBlock_SvlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kiFP"><span class="token-line" style="color:#393A34"><span class="token plain">S = (B^a) mod p</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_veCs clean-btn">Copy</button></div></div><p>Bob computes:</p><div class="codeBlockContainer_RIuc theme-code-block"><div class="codeBlockContent_DOR6"><pre tabindex="0" class="prism-code language-text codeBlock_SvlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kiFP"><span class="token-line" style="color:#393A34"><span class="token plain">S = (A^b) mod p</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_veCs clean-btn">Copy</button></div></div><p>And these 2 values magically equal to the same number S.</p><p>Why? Let&#x27;s do the math:</p><div class="codeBlockContainer_RIuc theme-code-block"><div class="codeBlockContent_DOR6"><pre tabindex="0" class="prism-code language-text codeBlock_SvlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_kiFP"><span class="token-line" style="color:#393A34"><span class="token plain">(B^a) mod p = (g^b)^a mod p = ( g^(b*a) ) mod p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(A^b) mod p = (g^a)^b mod p = ( g^(a*b) ) mod p</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_veCs clean-btn">Copy</button></div></div><p>So Alice and Bob come up with the same secret number S without leaking it to the public.</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="key-derivation-function---kdf">Key Derivation Function - KDF<a class="hash-link" href="#key-derivation-function---kdf" title="Direct link to heading">​</a></h3><p>Each encryption algorithm may require a secret key of different length. So to make the secret key, Alice and Bob must put S to the same key derivation function (KDF), and the output will be a shared secret key of required length.
In TLS 1.3, we use a HMAC-based key derivation function, so that’s why the name <strong> HKDF </strong>.</p><p><img loading="lazy" alt="HKDF2" src="/zh-CN/assets/images/HKDF2-ea94ba795bb64d126edb021c5dbb6dba.png" width="880" height="495">
Generally, the KDF takes following inputs:</p><ul><li>An input key material (or IKM). In our case, the IKM is the number S.</li><li>How long we want the output key to be, such as 128-bit.</li><li>A cryptographic hash function, such as HMAC-SHA256.</li><li>Optionally some context or application-specific information</li><li>An optional salt.
With all of these inputs, KDF will produce a secret key of required length.</li></ul><p><img loading="lazy" alt="HKDF1" src="/zh-CN/assets/images/HKDF1-97f4ba2e6239285dc50b1bb12c4a4bed.png" width="880" height="495"></p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="trapdoor-function">Trapdoor function<a class="hash-link" href="#trapdoor-function" title="Direct link to heading">​</a></h3><p>Now let&#x27;s get back to the Diffie-Hellman key exchange.
We know that p, g, A, B are known to the public, which means the hacker, Harry, also has access to those numbers.
We may wonder: Is this key exchange mechanism secure? Or given p, g, A, B, can Harry figure out the secret numbers: a, b, S?</p><p><img loading="lazy" alt="trapdoor1" src="data:image/png;base64,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" width="880" height="495">
Fortunately, these functions will be come trapdoors if we choose good values for p, g, a, b.</p><p>For example:</p><ul><li>Choose p as a 2048-bit prime number,</li><li>Choose g as a primitive root modulo p,</li><li>And choose a, b to be 256-bit random integers.</li></ul><p><img loading="lazy" alt="trapdoor2" src="/zh-CN/assets/images/trapdoor2-15eebfcbe64dae64a0b5af529ed3f649.png" width="880" height="495">
A trapdoor function basically means it’s easy to compute in one way but hard in the other. In this case:</p><ul><li>Given p, g, a, its’s easy to compute A.</li><li>But given p, g, A, it’s very hard to compute a.</li></ul><p>It’s easy to see that A can be computed pretty fast with O(log(a)) time complexity. It’s a well-known Modular exponentiation problem.
Computing a, on the other hand, is much harder. It’s a Discrete logarithm problem, which takes our current-generation of computers a very long time to solve.
So we’re at least safe for now, or until the next generation of strong quantum-computers comes into play.
However, for now, “a long time to solve” doesn’t mean unsolvable, right?</p><h3 class="anchor anchorWithHideOnScrollNavbar_tWSU" id="static-or-ephemeral-key">Static or Ephemeral key?<a class="hash-link" href="#static-or-ephemeral-key" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="static" src="/zh-CN/assets/images/static-18d3c3ba1617850ea21bdb1fa94edda6.png" width="880" height="495">
If Alice and Bob use the same private keys a, and b for every sessions that they communicate, then what happens is, Harry can record all of those sessions, and start solving for a from the session 1.
Although it will take him a long time to solve it, let’s say after session N, he gets the right a. Now he can use it to compute the secret number S, and thus, he would be able to decrypt all of the recorded conversations.
Does it sound scary? How can we prevent it?</p><p><img loading="lazy" alt="ephemeral" src="/zh-CN/assets/images/ephemeral-7b7762796fe4b373ea30a8df4447edf5.png" width="880" height="495">
The answer is ephemeral key. As the name may suggest, we use different private key or each session. So even if Harry can solve the secret key for 1 session, he could not use it for other ones.
This is called perfect forward secrecy in TLS.
So now you understand what Diffie-Hellman Ephemeral means. It’s just Diffie-Hellman with ephemeral or short-lived keys.</p><p><strong> How about Elliptic-Curve Diffie-Hellman Ephemeral? </strong>
<img loading="lazy" alt="elliptic-curve" src="/zh-CN/assets/images/elliptic-curve-0d9de7e1b8ff7a1adc62cc432a4427b8.png" width="880" height="495"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://crowdin.com/project/docusaurus-v2/zh-CN" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_S5JU" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated__dOF"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-02-08T11:42:41.000Z">2022/2/8</time></b> by <b>thebestornothing</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-CN/docs/tls/ssl-tls-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TLS Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-CN/docs/tls/asymmetric-cryptography"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Asymmetric Cryptography</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_RJmU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#bit-flipping-attack" class="table-of-contents__link toc-highlight">Bit-flipping attack</a></li><li><a href="#authenticated-encryption-ae" class="table-of-contents__link toc-highlight">Authenticated Encryption (AE)</a><ul><li><a href="#the-first-step-is-to-encrypt" class="table-of-contents__link toc-highlight">The first step is to encrypt.</a></li><li><a href="#the-second-step-is-to-authenticate" class="table-of-contents__link toc-highlight">The second step is to authenticate.</a></li><li><a href="#add-some-associated-data-ad" class="table-of-contents__link toc-highlight">Add some Associated Data (AD)</a></li><li><a href="#decryption-and-mac-verification" class="table-of-contents__link toc-highlight">Decryption and MAC verification</a></li></ul></li><li><a href="#secret-key-exchange" class="table-of-contents__link toc-highlight">Secret key exchange</a><ul><li><a href="#diffie-hellman-key-exchange" class="table-of-contents__link toc-highlight">Diffie-Hellman key exchange</a></li><li><a href="#key-derivation-function---kdf" class="table-of-contents__link toc-highlight">Key Derivation Function - KDF</a></li><li><a href="#trapdoor-function" class="table-of-contents__link toc-highlight">Trapdoor function</a></li><li><a href="#static-or-ephemeral-key" class="table-of-contents__link toc-highlight">Static or Ephemeral key?</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/migration">Migration from v1 to v2</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/feature-requests">Feature Requests</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/changelog">Changelog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item">
                <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wwR_"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BYRN"><img src="/zh-CN/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_xWK_ themedImage--light_gwRJ footer__logo" width="160" height="51"><img src="/zh-CN/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_xWK_ themedImage--dark_qMqj footer__logo" width="160" height="51"></a></div><div class="footer__copyright">Digital currencies are like a box of chocolates. You never know what you are gonna get.</div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.0163afa3.js"></script>
<script src="/zh-CN/assets/js/main.bb624438.js"></script>
</body>
</html>